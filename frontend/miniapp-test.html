<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Helpdesk Park">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3B82F6">
    <title>Helpdesk Park - Mini App Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .user-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .theme-toggle {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Helpdesk Park</h1>
            <p>–¢–µ—Å—Ç Mini App —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</p>
        </div>

        <div id="status" class="status warning">
            üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
        </div>

        <div class="info">
            <strong>üì± –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Mini App:</strong><br>
            1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ @helpdeskParkApp_bot –≤ Telegram<br>
            2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start<br>
            3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å Helpdesk Park"<br>
            4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Mini App
        </div>

        <div id="userInfo" class="user-info" style="display: none;">
            <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <div id="userDetails"></div>
        </div>

        <div class="theme-toggle">
            <button id="themeBtn" class="button">üé® –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
            <button id="expandBtn" class="button">üì± –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
            <button id="closeBtn" class="button">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>

        <div id="controls" style="display: none;">
            <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <button id="mainBtn" class="button">üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞</button>
            <button id="backBtn" class="button">‚¨ÖÔ∏è –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥</button>
            <button id="hapticBtn" class="button">üì≥ –í–∏–±—Ä–∞—Ü–∏—è</button>
            <button id="alertBtn" class="button">üí¨ –ê–ª–µ—Ä—Ç</button>
        </div>
    </div>

    <script>
        let tg = null;
        let isInitialized = false;

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function showUserInfo(user) {
            const userInfoEl = document.getElementById('userInfo');
            const userDetailsEl = document.getElementById('userDetails');
            
            userDetailsEl.innerHTML = `
                <p><strong>ID:</strong> ${user.id}</p>
                <p><strong>–ò–º—è:</strong> ${user.first_name} ${user.last_name || ''}</p>
                <p><strong>Username:</strong> ${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                <p><strong>–Ø–∑—ã–∫:</strong> ${user.language_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                <p><strong>Premium:</strong> ${user.is_premium ? '–î–∞' : '–ù–µ—Ç'}</p>
            `;
            
            userInfoEl.style.display = 'block';
        }

        function initTelegram() {
            if (window.Telegram?.WebApp) {
                tg = window.Telegram.WebApp;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ —á–µ—Ä–µ–∑ Telegram
                const isTelegram = tg.initDataUnsafe.query_id || tg.initDataUnsafe.user;
                
                if (!isTelegram) {
                    updateStatus('‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ —á–µ—Ä–µ–∑ Telegram Mini App. –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞.', 'warning');
                    return;
                }

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp
                tg.ready();
                isInitialized = true;
                
                updateStatus('‚úÖ Telegram WebApp —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!', 'success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('controls').style.display = 'block';
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe.user;
                if (user) {
                    showUserInfo(user);
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É
                const theme = tg.colorScheme;
                document.body.className = theme === 'dark' ? 'dark' : '';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞
                tg.setHeaderColor(theme === 'dark' ? '#1F2937' : '#FFFFFF');
                tg.setBackgroundColor(theme === 'dark' ? '#111827' : '#F9FAFB');
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
                tg.mainButton.setText('–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É');
                tg.mainButton.onClick(() => {
                    tg.showAlert('üéØ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞—è–≤–∫–∏');
                });
                
                tg.backButton.onClick(() => {
                    window.history.back();
                });
                
                console.log('Telegram WebApp initialized:', {
                    theme: theme,
                    user: user,
                    platform: 'Telegram WebApp'
                });
                
            } else {
                updateStatus('‚ùå Telegram WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('themeBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                const currentTheme = tg.colorScheme;
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                if (newTheme === 'dark') {
                    document.body.classList.add('dark');
                    tg.setHeaderColor('#1F2937');
                    tg.setBackgroundColor('#111827');
                } else {
                    document.body.classList.remove('dark');
                    tg.setHeaderColor('#FFFFFF');
                    tg.setBackgroundColor('#F9FAFB');
                }
                
                tg.showAlert(`üé® –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${newTheme}`);
            }
        });

        document.getElementById('expandBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                tg.expand();
                tg.showAlert('üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ');
            }
        });

        document.getElementById('closeBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                tg.close();
            }
        });

        document.getElementById('mainBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                if (tg.mainButton.isVisible) {
                    tg.mainButton.hide();
                    tg.showAlert('üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∞');
                } else {
                    tg.mainButton.show();
                    tg.showAlert('üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞');
                }
            }
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                if (tg.backButton.isVisible) {
                    tg.backButton.hide();
                    tg.showAlert('‚¨ÖÔ∏è –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ —Å–∫—Ä—ã—Ç–∞');
                } else {
                    tg.backButton.show();
                    tg.showAlert('‚¨ÖÔ∏è –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –ø–æ–∫–∞–∑–∞–Ω–∞');
                }
            }
        });

        document.getElementById('hapticBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                tg.hapticFeedback.impactOccurred('medium');
                tg.showAlert('üì≥ –í–∏–±—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            }
        });

        document.getElementById('alertBtn').addEventListener('click', () => {
            if (tg && isInitialized) {
                tg.showAlert('üí¨ –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Mini App!');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initTelegram);
        
        // –ï—Å–ª–∏ Telegram API –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ø–æ–∑–∂–µ
        if (window.Telegram?.WebApp) {
            initTelegram();
        } else {
            window.addEventListener('load', initTelegram);
        }
    </script>
</body>
</html>
